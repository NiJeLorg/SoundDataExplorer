<div class="modalDataWrapper">
	<div class="legendModal pull-right">
      <svg xmlns="http://www.w3.org/2000/svg" width="359.263" height="178.858"><defs><clipPath id="a"><path d="M0 841.68h1190.88V0H0v841.68z"/></clipPath><clipPath id="b"><path d="M0 841.68h1190.88V0H0v841.68z"/></clipPath><clipPath id="c"><path d="M0 841.68h1190.88V0H0v841.68z"/></clipPath><clipPath id="d"><path d="M0 841.68h1190.88V0H0v841.68z"/></clipPath><clipPath id="e"><path d="M0 841.795h1190.6V0H0v841.795z"/></clipPath></defs><text y="-413.069" x="1003.722" transform="matrix(1.25 0 0 1.25 -1095.369 616.19)" font-size="16.389"><tspan y="-413.069" x="1003.7219 1010.1625" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">A</tspan> <tspan y="-398.091" x="1003.722" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">B</tspan> <tspan y="-383.008" x="1003.254" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">C</tspan> <tspan y="-370.537" x="1003.254" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">D</tspan> <tspan y="-358.827" x="1003.7219 1008.769" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">F</tspan></text><g clip-path="url(#a)" transform="matrix(1.707 0 0 -1.707 -1645.57 786.827)"><path d="M1067.288 451.376v-94.75" fill="none" stroke="#6d6e71" stroke-miterlimit="10"/></g><g clip-path="url(#b)" transform="matrix(1.707 0 0 -1.707 -1645.57 786.827)"><path d="M979.45 412.4h176.662M969.952 356.625h198.025" fill="none" stroke="#6d6e71" stroke-miterlimit="10"/><path d="M1091.104 401.568c-1.907-.68-4.005.313-4.686 2.22-.68 1.907.313 4.005 2.22 4.686 1.907.68 4.005-.313 4.686-2.22.68-1.907-.313-4.005-2.22-4.686" fill="#009444"/><path d="M1091.104 361.75c-1.907-.68-4.005.314-4.686 2.22-.68 1.908.313 4.006 2.22 4.687 1.907.68 4.005-.313 4.686-2.22.68-1.907-.313-4.005-2.22-4.686" fill="#be1e2d"/></g><text y="-413.848" x="1020.668" transform="matrix(1.25 0 0 1.25 -1095.369 616.19)" font-size="16.389"><tspan y="-413.848" x="1020.6684 1024.8256 1030.2357 1034.9315 1039.6273" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">Pass</tspan> <tspan y="-358.821" x="1026.3948 1030.1187 1035.5288 1037.6835 1039.6273" style="-inkscape-font-specification:PrintClearly" font-size="11.71" font-weight="bold" fill="#6d6e71" font-family="Print Clearly">Fail</tspan></text><g clip-path="url(#c)" transform="matrix(1.707 0 0 -1.707 -1645.57 788.827)"><path d="M988.817 372.64c0-6.416-5.2-11.616-11.615-11.616s-11.615 5.2-11.615 11.615c0 6.414 5.2 11.614 11.615 11.614s11.615-5.2 11.615-11.615" fill="#f9ae08"/></g><text x="1108.429" y="597.77" font-size="20.486" transform="translate(-1095.369 -433.91)"><tspan style="-inkscape-font-specification:PrintClearly" x="1108.429" y="597.77" font-size="35.617" font-weight="bold" fill="#fff" font-family="Print Clearly">C</tspan></text><path d="M336.465 151.716v-19.578c-10.76 0-19.485 8.744-19.485 19.53 0 10.787 8.724 19.53 19.485 19.53 10.746 0 19.456-8.718 19.482-19.482h-19.482z" fill="#009444"/><path d="M355.997 151.668c0-10.76-8.743-19.485-19.53-19.485v19.485h19.53z" fill="#be1e2d"/><path d="M352.307 151.668c0 8.748-7.093 15.84-15.84 15.84-8.75 0-15.844-7.092-15.844-15.84 0-8.748 7.093-15.84 15.843-15.84 8.748 0 15.84 7.092 15.84 15.84" fill="#fff"/><path d="M299.442 46.157c6.487 6.487 17.002 6.487 23.487.002 6.484-6.486 6.484-17-.003-23.488L311.184 10.93l-11.742 11.742c-6.485 6.483-6.485 17 0 23.485" fill="#c1e6e7"/><path d="M299.442 46.157c6.487 6.487 17.002 6.487 23.487.002 6.484-6.486 6.484-17-.003-23.488L311.184 10.93l-11.742 11.742c-6.485 6.483-6.485 17 0 23.485z" fill="none" stroke="#098ca8" stroke-width="3.414" stroke-miterlimit="10"/><text x="1367.385" y="482.205" font-size="20.486" transform="translate(-1068.226 -443.205)"><tspan style="-inkscape-font-specification:PrintClearly" x="1367.3848 1373.7825 1379.9467" y="482.205" font-size="18" font-weight="bold" fill="#098ca8" font-family="Print Clearly">85%</tspan></text><path d="M52.016 31.143c0 8.784-7.12 15.904-15.904 15.904-8.784 0-15.906-7.12-15.906-15.904 0-8.784 7.122-15.904 15.906-15.904s15.904 7.12 15.904 15.903" fill="#ef4136"/><path d="M52.016 31.143c0 8.784-7.12 15.904-15.904 15.904-8.784 0-15.906-7.12-15.906-15.904 0-8.784 7.122-15.904 15.906-15.904s15.904 7.12 15.904 15.903z" fill="none" stroke="#f7941e" stroke-width="3.414" stroke-miterlimit="10"/><path d="M58.067 31.143h7.478M51.636 15.617l5.288-5.288M36.11 9.186V1.708M20.584 15.617l-5.288-5.288M20.584 46.67l-4.2 4.2M36.152 52.763v7.478M51.636 46.67l5.288 5.287" fill="none" stroke="#fbb040" stroke-width="3.414" stroke-linecap="round" stroke-miterlimit="10"/><text x="1156.448" y="475.131" font-size="20.486" transform="translate(-1131.798 -438.624)"><tspan style="-inkscape-font-specification:PrintClearly" x="1156.4481 1162.4258 1168.4034" y="475.131" font-size="18" font-weight="bold" fill="#fff" font-family="Print Clearly">27%</tspan></text><g clip-path="url(#d)" transform="matrix(1.707 0 0 -1.707 -1681.999 784.113)"><path d="M988.546 441.06h4.38" fill="none" stroke="#fbb040" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10"/></g><g transform="matrix(1.668 0 0 -1.668 -1603.737 782.403)" clip-path="url(#e)"><path d="M1052.95 408.2c-1.908-.68-4.006.313-4.687 2.22-.68 1.907.313 4.005 2.22 4.686 1.907.68 4.005-.313 4.686-2.22.68-1.908-.314-4.006-2.22-4.687" fill="#39b54a"/><path d="M1052.937 397.273c-1.907-.68-4.005.313-4.686 2.22-.68 1.907.314 4.005 2.22 4.686 1.908.68 4.006-.314 4.687-2.22.68-1.908-.313-4.006-2.22-4.687" fill="#f7e34f"/><path d="M1052.925 387.023c-1.907-.68-4.005.313-4.686 2.22-.682 1.907.312 4.005 2.22 4.686 1.906.68 4.004-.314 4.685-2.22.68-1.908-.313-4.006-2.22-4.687" fill="#f9ae08"/><path d="M1052.914 376.845c-1.907-.68-4.005.313-4.686 2.22-.68 1.907.313 4.005 2.22 4.686 1.907.682 4.005-.312 4.686-2.22.68-1.906-.313-4.004-2.22-4.685" fill="#f47f45"/><path d="M1052.903 367.37c-1.907-.68-4.005.313-4.686 2.22-.68 1.908.313 4.006 2.22 4.687 1.907.68 4.005-.313 4.686-2.22.68-1.908-.313-4.006-2.22-4.687" fill="#ef4136"/></g><text style="line-height:82.99999833%;-inkscape-font-specification:Print Clearly" x="1237.105" y="550.96" font-size="24" font-weight="300" letter-spacing="0" word-spacing="0" fill="#6d6e71" font-family="Print Clearly" transform="translate(-1095.369 -435.91)"><tspan x="1235.655" y="550.96" style="text-align:end;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45" text-anchor="end">Average of</tspan><tspan x="1235.655" y="569.22" style="text-align:end;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45" text-anchor="end">Multiple Samples</tspan></text><text style="text-align:start;line-height:82.99999833%;-inkscape-font-specification:Print Clearly" x="1313.209" y="556.96" font-size="24" font-weight="300" letter-spacing="0" word-spacing="0" fill="#6d6e71" font-family="Print Clearly" transform="translate(-1095.369 -435.91)"><tspan x="1313.209" y="556.96" style="text-align:start;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45">Individual </tspan><tspan x="1313.209" y="575.22" style="text-align:start;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45">Sample Score</tspan></text><text style="text-align:start;line-height:82.99999833%;-inkscape-font-specification:Print Clearly" x="1278.528" y="491.235" font-size="24" font-weight="300" letter-spacing="0" word-spacing="0" fill="#6d6e71" font-family="Print Clearly" transform="translate(-1095.369 -435.91)"><tspan x="1278.528" y="491.235" style="text-align:start;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45">Percentage of</tspan><tspan x="1278.528" y="509.495" style="text-align:start;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45">Wet Weather Samples</tspan></text><text style="text-align:end;line-height:82.99999833%;-inkscape-font-specification:Print Clearly" x="1266.79" y="491.235" font-size="24" font-weight="300" letter-spacing="0" word-spacing="0" text-anchor="end" fill="#6d6e71" font-family="Print Clearly" transform="translate(-1095.369 -435.91)"><tspan x="1265.34" y="491.235" style="text-align:end;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45">Percentage of</tspan><tspan x="1265.34" y="509.495" style="text-align:end;line-height:82.99999833%;-inkscape-font-specification:'Print Clearly,'" font-size="22" font-weight="normal" letter-spacing="-1.45">Dry Weather Samples</tspan></text></svg>
    </div>
    <div class="clearfix"></div>
	<h4 class='pull-left'>{{ beach.BeachName }}</h4>
	<div class='pull-right'>
		<small>Most Recent Sample: {{ latestSample.CharacteristicName }}</small>
		<span id="mostRecentSample"></span>
	</div>
	<div class="clearfix"></div>
	<hr />
    <div role="tabpanel">
  <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#bacteria" aria-controls="home" role="tab" data-toggle="tab">Bacteria & Fecal Pollution</a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="bacteria">
            <form class="form-inline padding-top-5 padding-bottom-10">
              <div class="form-group">
                <label for="vdaModal">View Data As: </label>
                <select class="form-control" id="vdaModal">
                {% if tab == "precip" %}
                  <option value="precip" selected>Precipitation Information</option>
                  <option value="spreadsheet">Interactive Spreadsheet</option>
                  <option value="timeline">Interactive Timeline</option>
                {% elif tab == "spreadsheet" %}
                  <option value="precip">Precipitation Information</option>
                  <option value="spreadsheet" selected>Interactive Spreadsheet</option>
                  <option value="timeline" >Interactive Timeline</option>
                {% else %}
                  <option value="precip">Precipitation Information</option>
                  <option value="spreadsheet">Interactive Spreadsheet</option>
                  <option value="timeline" selected>Interactive Timeline</option>
                {% endif %}
                </select>
              </div>
              <div class="form-group pull-right">
                <label for="start_date">Select Data Between: </label>
                <select class="form-control" name="start_date_modal" id="start_date_modal"></select>
                <select class="form-control" name="end_date_modal" id="end_date_modal"></select>
              </div>
            </form>
            <div class="clearfix"></div>
            <div id="precip" class="show">
            	<h4>For the selected time period this site's samples failed:</h4>
            	<div class="container-fluid marginTopBottom20">
	              	<div class="col-md-6">
	            		<div id="ringSvgModal" class="pull-left"></div>
	            		<div id="ringTextModal" class='textPopup textDropPopup'></div>
	            	</div>
	            	<div class="col-md-6">
	            		<div id="dropSvgModal" class="dropMargin pull-left"></div>
	            		<div id="dropTextModal" class='textPopup textDropPopup'></div>
	            		<div class="clearfix"></div>
	            		<div id="sunSvgModal" class="pull-left"></div>
	            		<div id="sunTextModal" class='textPopup textSunPopup'></div>
	            	</div>          	
            	</div>
            </div>
            <div id="spreadsheet" class="hidden">
            	<div class="container-fluid marginTopBottom20">
	            	<div class="col-md-8">
	            		<table class="table table-bordered table-condensed sortable">
	            			<thead>
	            				<th data-defaultsort="desc">Date</th>
	            				<th>Type</th>
	            				<th>Score</th>
	            				<th>Rainfall</th>
	            			</thead>
	            			<tbody>
	            				{% for sample in samples %}
	            					<tr>
		            					<td data-dateformat="MM/DD/YYYY">{{ sample.StartDate|date:"m/d/Y" }}</td>
		            					<td>{{ sample.CharacteristicName }}</td>
		            					{% if sample.ResultValue >= 104 %}
		            						<td class="danger">{{ sample.ResultValue|floatformat }}</td>
		            					{% else %}
		            						<td class="success">{{ sample.ResultValue|floatformat }}</td>
		            					{% endif %}

		            					{% if sample.precipSum >= 0.5 %}
		            						<td class="info">{{ sample.precipSum|floatformat }}</td>
		            					{% else %}
		            						<td class="warning">{{ sample.precipSum|floatformat }}</td>
		            					{% endif %}
		            					
	            					</tr>
	            				{% endfor %}         				
	            			</tbody>
	            		</table>
	            	</div>          	
	            	<div class="col-xs-3">
	            			<p>Mean: </p>
	            			<p>Minimum: </p>
	            			<p>Maximum: </p>
	            			<p>Dry Samples: </p>
	            			<p>Wet Samples: </p>
	            			<p>Total Samples: </p>
	            	</div>
	            	<div class="col-xs-1">
	            		{% for sample in sampleAggregates %}
	            			<p>{{ sample.AvgValue|floatformat }}</p>
	            			<p>{{ sample.MinValue|floatformat }}</p>
	            			<p>{{ sample.MaxValue|floatformat }}</p>
	            		{% endfor %}
	            		{% for score in scores %}
	            			<p>{{ score.TotalDryWeatherSamplesSum|floatformat }}</p>
	            			<p>{{ score.TotalWetWeatherSamplesSum|floatformat }}</p>
	            			<p>{{ score.NumberOfSamplesSum|floatformat }}</p>
						{% endfor %}
	            	</div>
            	</div>            	
            </div>
            <div id="timeline" class="show">
            	<div id="timeSliderModal"></div>
            </div>
            <div class="clearfix"></div>
            <hr />
            <small>
            	Our Partners at Sample Location United provided us with this data. Learn more about them at <a href="#">Data Sources</a>. This bacteria data is scored based on the US EPA criteria for safe primary contact (swimming). More information on <a href="#">Criteria & Scoring</a>. 
            </small>

        </div>
    </div>
</div>



</div>


<script type="text/javascript">
	$( document ).ready(function() {

		function drawIndicatorBar() {
			var value = parseInt({{ latestSample.ResultValue }});
			var valuePrint = value;
			// set any sample > 200 = to 200 for the linear scale 
			if (value > 200) {
				value = 200;
			}

			//create svg for most recent sample
			var scale = d3.scale.linear()
	            .domain([0, 200])
	            .range([0, 100]);

	        var firstPoint = scale(value) + 10;
	        var secondPoint = scale(value) + 20;
	        var thirdPoint = scale(value) + 15;

	        var points =  firstPoint + ",15 " + secondPoint + ",15 " + thirdPoint + ", 25";

			var mostRecentSample = d3.select("#mostRecentSample")
				.append('svg')
				.attr('width', 130)
				.attr('height', 26);

			mostRecentSample.append('rect')
				.attr('width', scale(200))
				.attr('height', 6)
				.attr('x', 15)
				.attr('y', 20)
				.attr('style', 'fill: #be1e2d');

			mostRecentSample.append('rect')
				.attr('width', scale(104))
				.attr('height', 6)
				.attr('x', 15)
				.attr('y', 20)
				.attr('style', 'fill: #009444');

			mostRecentSample.append('polygon')
				.attr('points', points)
				.attr('style', 'fill: #545454');

			mostRecentSample.append("text")
				.attr("text-anchor", "middle")
				.attr("dx", thirdPoint)
				.attr("dy", 13)
				.attr('style', "font-size: 14px;")
				.text(value);			
		}



		// create start and end date combo boxes
		function createStartEndCombos() {
			var start_date_options = '';
			var end_date_options = '';

			var start_date_selected = moment($( "#start_date option:selected" ).val());
			var end_date_selected = moment($( "#end_date option:selected" ).val());

			var minDate = moment(new Date(2004,0,1));
			var checkDate = moment().startOf('month');

			while (checkDate.isAfter(minDate)) {
				var value = checkDate.format('YYYY-MM-DD');
				var printValue = checkDate.format('MMM YYYY');
				var selected_start = '';
				var selected_end = '';
				if (checkDate.isSame(start_date_selected)) {
					var selected_start = 'selected';
				}
				if (checkDate.isSame(end_date_selected)) {
					var selected_end = 'selected';
				}

				start_date_options += '<option ' + selected_start + ' value="' + value + '">' + printValue + '</option>'; 

				end_date_options += '<option ' + selected_end + ' value="' + value + '">' + printValue + '</option>'; 

				checkDate.subtract(1, 'months');
			}

			$('#start_date_modal').html(start_date_options);
			$('#end_date_modal').html(end_date_options);			
		}



		// draw ring chart
		function drawRingChart() {
			{% for score in scores %}
				var TotalPassSamplesSum = {{ score.TotalPassSamplesSum }};
				var NumberOfSamplesSum = {{ score.NumberOfSamplesSum }};
			{% endfor %}

			var pctPass = ((TotalPassSamplesSum / NumberOfSamplesSum) * 100);
			var pctFail = 100 - pctPass;

			var pctPassFail = [{name: "fail", pct: pctFail},{name: "pass", pct: pctPass}];

			var w = 150;
			var h = 150;
			var innerRadius = 65;
			var outerRadius = 75;

			var arc = d3.svg.arc()
			    .outerRadius(outerRadius)
			    .innerRadius(innerRadius);

			var pie = d3.layout.pie()
				.sort(null)
				.value(function(d) { return d.pct; });

			var ringSvg = d3.select('#ringSvgModal').append('svg')
				.attr('width', w)
				.attr('height', h)
				.append('g')
				.attr("class", "rings")
				.attr("transform", "translate("+w/2+","+h/2+")")
				.selectAll(".arc")
				.data(function(d) { return pie(pctPassFail); });

			ringSvg.enter().append('text')
				.attr("text-anchor", "middle")
				.attr("transform", "translate(0,12)")
				.attr('style', function(d) { 
					if (d.data.name == "fail") {
						var pctNum = +d.data.pct;
						if (pctNum == 100) {
							var fontSize = 42;
						} else {
							var fontSize = 50;
						}				
						return "font-size: "+ fontSize +"; stroke: #be1e2d; }"
					} 
				})
				.text(function(d) { 
					if (d.data.name == "fail") {
						return d.data.pct.toFixed(0) + "%";
					}
				});


			var rings = ringSvg.enter()
				.append("path")
				.attr("class", "arc")
				.attr("d", arc)
				.style("fill", function(d) {
					if (d.data.name == "pass") {
						return "#009444";
					} else {
						return "#be1e2d";
					}
				});

			//add text next to ring chart
			$('#ringTextModal').text(pctFail.toFixed(0) + "% of the time in total.");

		}


		// draw raindrop chart
		function drawDropChart() {
			{% for score in scores %}
				var WetWeatherPassSamplesSum = {{ score.WetWeatherPassSamplesSum }};
				var TotalWetWeatherSamplesSum = {{ score.TotalWetWeatherSamplesSum }};
			{% endfor %}

			var pctWetFail = 100 - ((WetWeatherPassSamplesSum / TotalWetWeatherSamplesSum) * 100).toFixed(0);

			var dropSvg = '<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" width="53.771" height="59.867249" id="svg2" xml:space="preserve"><g transform="matrix(1.25,0,0,-1.25,0,59.86725)" id="g10"><g transform="translate(9.4551,8.6643)"id="g20"><path d="m 0,0 c 6.529,-6.529 17.116,-6.53 23.643,-0.002 6.528,6.528 6.527,17.114 -0.002,23.643 L 11.82,35.462 0,23.642 C -6.528,17.114 -6.528,6.528 0,0" id="path22" style="fill:#c1e5e6;fill-opacity:1;fill-rule:nonzero;stroke:none" /></g><g transform="translate(9.4551,8.6643)" id="g24"><path d="m 0,0 c 6.529,-6.529 17.116,-6.53 23.643,-0.002 6.528,6.528 6.527,17.114 -0.002,23.643 L 11.82,35.462 0,23.642 C -6.528,17.114 -6.528,6.528 0,0 z" id="path26" style="fill:none;stroke:#0a8ba7;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-opacity:1;stroke-dasharray:none" /></g></g>';

			// change translation if 100%, between 99 and 10 percent and less than 10 percent.
			if (pctWetFail == 100) {
				var fontSize = 16;
				var translateRight = 9;
			} else if (pctWetFail > 9.99) {
				var fontSize = 20;
				var translateRight = 10;		
			} else {
				var fontSize = 20;
				var translateRight = 15;				
			}

			var dropSvgText = '<g transform="translate('+ translateRight +',40)" id="g26"><text style="font-family:\'Print Clearly\'; font-size: '+ fontSize +'; stroke:#0a8ba7;">'+pctWetFail+'%</text></g>';

			var dropSvgClose = '</svg>';

			dropSvg = dropSvg + dropSvgText + dropSvgClose;

			$('#dropSvgModal').append(dropSvg);

			$('#dropTextModal').text(pctWetFail + "% of the time after wet weather.");

		}


		// draw sun chart
		function drawSunChart() {
			{% for score in scores %}
				var DryWeatherPassSamplesSum = {{ score.DryWeatherPassSamplesSum }};
				var TotalDryWeatherSamplesSum = {{ score.TotalDryWeatherSamplesSum }};
			{% endfor %}

				var pctDryFail = 100 - ((DryWeatherPassSamplesSum / TotalDryWeatherSamplesSum) * 100).toFixed(0);

			var sunSvg = '<svg width="78.911" height="78.212"><g transform="matrix(1.25 0 0 -1.25 0 78.21)"><path d="M46.63 30.497c0-8.034-6.512-14.546-14.545-14.546-8.034 0-14.546 6.513-14.546 14.547s6.51 14.546 14.545 14.546c8.033 0 14.546-6.512 14.546-14.546" fill="#ee4137"/><path d="M46.63 30.497c0-8.034-6.512-14.546-14.545-14.546-8.034 0-14.546 6.513-14.546 14.547s6.51 14.546 14.545 14.546c8.033 0 14.546-6.512 14.546-14.546z" fill="none" stroke="#f79420" stroke-width="3" stroke-miterlimit="10"/><path d="M52.164 30.497h6.84M46.283 44.695l4.836 4.836M32.085 50.576v6.84M17.886 44.695L13.05 49.53M17.886 16.298l-3.842-3.842M32.123 10.726v-6.84M46.283 16.298l4.836-4.836M4.207 30.497h6.84" fill="none" stroke="#faaf41" stroke-width="5" stroke-linecap="round" stroke-miterlimit="10"/></g>';

			// change translation if 100%, between 99 and 10 percent and less than 10 percent.
			if (pctDryFail == 100) {
				var fontSize = 14;
				var translateRight = 24;
			} else if (pctDryFail > 9.99) {
				var fontSize = 18;
				var translateRight = 25;		
			} else {
				var fontSize = 20;
				var translateRight = 28;				
			}


			var sunSvgText = '<g transform="translate('+ translateRight +',45)" id="g26"><text style="font-family:\'Print Clearly\'; font-size: '+ fontSize +'; stroke:#fff;">'+pctDryFail+'%</text></g>';

			var sunSvgClose = '</svg>';

			sunSvg = sunSvg + sunSvgText + sunSvgClose;

			$('#sunSvgModal').append(sunSvg);

			$('#sunTextModal').text(pctDryFail + "% of the time after dry weather.");

		}


		function drawTimeSliderModal() {
			var minDate = new Date(2004,0,1);
			var maxDate = moment().toDate();
			var start_date_selected = moment($( "#start_date option:selected" ).val()).toDate();
			var end_date_selected = moment($( "#end_date option:selected" ).val()).toDate();

			var mapSliderModal = d3.slider()
							.axis(
								d3.svg.axis()
									.orient("top")
									.scale(
										d3.time.scale()
											.domain([minDate, maxDate])
									)
									.ticks(d3.time.years)
									.tickSize(24, 0)
									.tickFormat(d3.time.format("%Y"))
							)
							.scale(
								d3.time.scale()
									.domain([minDate, maxDate])
							)
							.value( [ start_date_selected, end_date_selected ] )
							.on("slideend", function(evt, value) {
								$("body").addClass("loading");
								// run a function to update map layers with new dates
								SoundExplorerMap.updateMapFromSlider(value);
								SoundExplorerModalMap.updateMapFromSlider(value);
								// update combo boxes
								var start_date = moment(value[0]).format('YYYY-MM');
								start_date = start_date + '-01';
								$( "#start_date" ).val(start_date);
								$( "#start_date_modal" ).val(start_date);
								var end_date = moment(value[1]).format('YYYY-MM');
								end_date = end_date + '-01';
								$( "#end_date" ).val(end_date);
								$( "#end_date_modal" ).val(end_date);
								// update modalData
								updateModalData();

							});

			d3.select('#timeSliderModal').call(mapSliderModal);

			// ensure the correct tabs are hidden and shown
		    {% if tab == "precip" %}
		    	$('#timeline').removeClass('show').addClass('hidden');
            {% elif tab == "spreadsheet" %}
            	$('#precip').removeClass('show').addClass('hidden');
            	$('#timeline').removeClass('show').addClass('hidden');
            	$('#spreadsheet').removeClass('hidden').addClass('show');
            {% else %}
            	$('#precip').removeClass('show').addClass('hidden');
            {% endif %}

		}


		// run functions
		drawIndicatorBar();
		createStartEndCombos();
		drawRingChart();
		drawDropChart();
		drawSunChart();
		drawTimeSliderModal();
		// to ensure tables will sort
		$.bootstrapSortable();



		// on change listener for combo box
		$('#vdaModal').change(function() {
			// remove show class
			if ($('#precip').hasClass('show')) {
				$('#precip').removeClass('show').addClass('hidden');
			}
			if ($('#spreadsheet').hasClass('show')) {
				$('#spreadsheet').removeClass('show').addClass('hidden');
			}
			if ($('#timeline').hasClass('show')) {
				$('#timeline').removeClass('show').addClass('hidden');
			}

			var show = $( "#vdaModal option:selected" ).val();
			$('#'+show).removeClass('hidden').addClass('show');

		});

		// on change listeners for combo boxes to change sliders, maps, modal templates
		$( "#start_date_modal" ).change(function() {
		  updateSliderModal();
		});

		$( "#end_date_modal" ).change(function() {
		  updateSliderModal();
		});

		function updateSliderModal (minDate, maxDate, start_date, end_date) {
			$("body").addClass("loading");

			var minDate = new Date(2004,0,1);
			var maxDate = moment().toDate();
			var start_date = moment($( "#start_date_modal option:selected" ).val()).toDate();
			var end_date = moment($( "#end_date_modal option:selected" ).val()).toDate();

			// destroy main map slider
		  	d3.select('#timeSlider').selectAll("*").remove();

		  	// recreate main map slider
			mapSlider = d3.slider()
					.axis(
						d3.svg.axis()
							.orient("top")
							.scale(
								d3.time.scale()
									.domain([minDate, maxDate])
							)
							.ticks(d3.time.years)
							.tickSize(24, 0)
							.tickFormat(d3.time.format("%Y"))
					)
					.scale(
						d3.time.scale()
							.domain([minDate, maxDate])
					)
					.value( [ start_date, end_date ] )
					.on("slideend", function(evt, value) {
						// run a function to update map layers with new dates
						SoundExplorerMap.updateMapFromSlider(value);
						// update combo boxes
						var start_date = moment(value[0]).format('YYYY-MM');
						start_date = start_date + '-01';
						$( "#start_date" ).val(start_date);
						var end_date = moment(value[1]).format('YYYY-MM');
						end_date = end_date + '-01';
						$( "#end_date" ).val(end_date);					
					});

			d3.select('#timeSlider').call(mapSlider);

			// update the map data on both the main map and the modal map
			var value = [ start_date, end_date ];
			SoundExplorerMap.updateMapFromSlider(value);
			SoundExplorerModalMap.updateMapFromSlider(value);

			//update main map combo boxes
			var start_date = moment($( "#start_date_modal option:selected" ).val()).format('YYYY-MM');
			start_date = start_date + '-01';
			$( "#start_date" ).val(start_date);
			$( "#start_date_modal" ).val(start_date);
			var end_date = moment($( "#end_date_modal option:selected" ).val()).format('YYYY-MM');
			end_date = end_date + '-01';
			$( "#end_date" ).val(end_date);
			$( "#end_date_modal" ).val(end_date);
			updateModalData();
		}

		function updateModalData() {
			var startDate = moment($( "#start_date_modal option:selected" ).val()).format("YYYY-MM-DD");
			var endDate = moment($( "#end_date_modal option:selected" ).val()).format("YYYY-MM-DD");
			var beachid = "{{ beach.BeachID }}";

			// which tab is open
			if ($('#precip').hasClass('show')) {
				var tab = 'precip';
			}
			if ($('#spreadsheet').hasClass('show')) {
				var tab = 'spreadsheet';
			}
			if ($('#timeline').hasClass('show')) {
				var tab = 'timeline';
			}


			$.ajax({
		        type: 'GET',
		        url:  'modalapi/?startDate=' + startDate + '&endDate=' + endDate + '&beachId=' + beachid + '&tab=' + tab,
		        success: function(data){
		        	$("body").removeClass("loading");
		        	$("#modalData").html(data);
		        }
		    });

		}




	});


</script>
